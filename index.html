<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Teleprompter Pro Voz</title>

<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }

  #viewport {
    height: 100vh;
    overflow-y: hidden; /* El scroll lo controlamos por JS */
    scroll-behavior: smooth; /* Esto suaviza el movimiento considerablemente */
  }

  #text {
    padding: 50vh 40px; /* 50vh arriba permite que la primera frase empiece al centro */
    padding-bottom: 70vh; 
    font-size: 38px;
    line-height: 1.5;
    max-width: 90%;
    margin: auto;
    outline: none;
    transition: font-size 0.2s, max-width 0.2s;
  }

  /* Clase para el modo espejo */
  .mirror-mode {
    transform: scaleX(-1);
  }

  #controls {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 5px;
    background: rgba(30,30,30,0.9);
    padding: 10px;
    border-radius: 12px;
    z-index: 100;
    width: 95%;
    max-width: 600px;
  }

  button {
    font-size: 14px;
    padding: 8px 12px;
    cursor: pointer;
    background: #444;
    color: white;
    border: none;
    border-radius: 4px;
  }

  button:active { background: #666; }
  
  .active-mic { background: #d32f2f !important; }

  /* L√≠nea gu√≠a central opcional */
  #guide {
    position: fixed;
    top: 50%;
    left: 0;
    width: 100%;
    height: 2px;
    background: rgba(255,255,255,0.1);
    pointer-events: none;
  }
</style>
</head>

<body>

<div id="guide"></div>

<div id="viewport">
  <div id="text" contenteditable="true" spellcheck="false">
    ¬°Hola! Pega aqu√≠ tu guion. <br><br>
    Pulsa el micr√≥fono y empieza a leer. El texto subir√° autom√°ticamente para mantenerse en el centro de la pantalla seg√∫n lo que vayas diciendo.
  </div>
</div>

<div id="controls">
  <button id="micBtn">üéôÔ∏è Mic</button>
  <button id="mirrorBtn">ü™û Espejo</button>
  <button id="plusBtn">A+</button>
  <button id="minusBtn">A-</button>
  <button id="marginPlus">‚ÜîÔ∏è+</button>
  <button id="marginMinus">‚ÜîÔ∏è-</button>
  <button id="leftBtn">‚¨ÖÔ∏è</button>
  <button id="centerBtn">‚¨ÜÔ∏è</button>
  <button id="rightBtn">‚û°Ô∏è</button>
  <button id="resetBtn">üîÑ Reset</button>
</div>

<script>
const viewport = document.getElementById("viewport");
const textElem = document.getElementById("text");
const micBtn = document.getElementById("micBtn");

let isListening = false;
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition;

if (SpeechRecognition) {
  recognition = new SpeechRecognition();
  recognition.lang = 'es-ES';
  recognition.continuous = true;
  recognition.interimResults = true;

  recognition.onresult = (event) => {
    let transcript = '';
    for (let i = event.resultIndex; i < event.results.length; ++i) {
      transcript += event.results[i][0].transcript;
    }
    sincronizarTexto(transcript.toLowerCase());
  };

  recognition.onend = () => { if (isListening) recognition.start(); };
}

function sincronizarTexto(voz) {
  const palabras = voz.split(' ');
  const ultimaPalabra = palabras[palabras.length - 1];
  
  const contenido = textElem.innerText.toLowerCase();
  const index = contenido.lastIndexOf(ultimaPalabra);

  if (index !== -1) {
    const selection = window.getSelection();
    const range = document.createRange();
    
    // Intentamos localizar la posici√≥n de la palabra en el nodo de texto
    if (textElem.firstChild) {
      try {
        range.setStart(textElem.firstChild, index);
        range.setEnd(textElem.firstChild, index + ultimaPalabra.length);
        
        const rect = range.getBoundingClientRect();
        // Calculamos el desplazamiento necesario para centrar la palabra
        const scrollTarget = viewport.scrollTop + rect.top - (window.innerHeight / 2);
        
        viewport.scrollTo({
          top: scrollTarget,
          behavior: 'smooth' // Movimiento suave
        });
      } catch(e) { /* Evita errores si el nodo cambia mientras se edita */ }
    }
  }
}

/* BOTONES RECUPERADOS Y FUNCIONALES */

// Micr√≥fono
micBtn.onclick = () => {
  if (!SpeechRecognition) return alert("Navegador no compatible");
  if (!isListening) {
    recognition.start();
    isListening = true;
    micBtn.classList.add("active-mic");
    textElem.contentEditable = "false";
  } else {
    recognition.stop();
    isListening = false;
    micBtn.classList.remove("active-mic");
    textElem.contentEditable = "true";
  }
};

// Espejo
document.getElementById("mirrorBtn").onclick = () => textElem.classList.toggle("mirror-mode");

// Tama√±o de fuente
let fontSize = 38;
document.getElementById("plusBtn").onclick = () => { fontSize += 4; textElem.style.fontSize = fontSize + "px"; };
document.getElementById("minusBtn").onclick = () => { fontSize = Math.max(16, fontSize - 4); textElem.style.fontSize = fontSize + "px"; };

// M√°rgenes laterales (Ancho del texto)
let textWidth = 90;
document.getElementById("marginPlus").onclick = () => { textWidth = Math.min(100, textWidth + 5); textElem.style.maxWidth = textWidth + "%"; };
document.getElementById("marginMinus").onclick = () => { textWidth = Math.max(30, textWidth - 5); textElem.style.maxWidth = textWidth + "%"; };

// Alineaci√≥n
document.getElementById("leftBtn").onclick = () => textElem.style.textAlign = "left";
document.getElementById("centerBtn").onclick = () => textElem.style.textAlign = "center";
document.getElementById("rightBtn").onclick = () => textElem.style.textAlign = "right";

// Reset
document.getElementById("resetBtn").onclick = () => { viewport.scrollTo({top: 0, behavior: 'smooth'}); };

</script>
</body>
</html>
